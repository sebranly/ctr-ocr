(this["webpackJsonpctr-ocr"]=this["webpackJsonpctr-ocr"]||[]).push([[0],{146:function(e,t,n){e.exports=n(386)},151:function(e,t,n){},152:function(e,t,n){},190:function(e,t){},192:function(e,t){},219:function(e,t){},386:function(e,t,n){"use strict";n.r(t);var a,r=n(0),c=n.n(r),l=n(138),i=n.n(l),o=(n(151),n(7)),s=n(13),u=n(8),m=n.n(u),h=n(46),f=(n(152),n(74)),d=n(76);!function(e){e.Position="position",e.Time="time",e.Username="username",e.All="all"}(a||(a={}));var g=n(141),p=n.n(g),b=n(142),v=n.n(b),E=n(145),y=n.n(E),w=n(143),x=n.n(w),j=n(47),k=n(45),N=n(144),O=n.n(N),C=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2?arguments[2]:void 0;return n?1*e/4+t/n*(1-1*e/4):1*e/4},P=function(e){return e&&0!==e.length?e.filter((function(e){return!!e})).sort().join(Y):""},S=function(e){return e?e.split(Y).filter((function(e){return!!e})):[]},_=function(e,t,n){if(!e)return[];var a=S(e);if(!n||!t)return a;var r=S(t);return[].concat(Object(s.a)(a),Object(s.a)(r))},A=function(e,t){var n=t.filter((function(e){return!!e})),a=1/0,r=e;return n.forEach((function(t){var n=O.a.get(e,t);n<a&&(a=n,r=t)})),r},T=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2?arguments[2]:void 0,r=e.width,c=e.height,l=J(.64,r),i=J(.265,c),o=J(.27,r),s=J(.425,c);if(n===a.All){var u=t/R,m={height:J(u,s),left:l,top:i,width:o};return m}var h=.73,f=.03,d=.27,g=.1,p=1-h-f,b={top:J(t/8,s),height:J(1/8,s)},v=i+b.top,E=b.height;if(n===a.Position){var y={height:E,left:l,top:v,width:J(g,o)};return y}var w=l+J(h,o),x=J(p,o),j=l+J(d,o),k=J(1-p-d-f,o),N=n===a.Time,O=N?w:j,C=N?x:k,P={height:E,left:O,top:v,width:C};return P},U=function(e,t){for(var n=[],a=e;a<=t;a+=1)n.push(a);return n},M=function(e){var t=a.Position,n=a.Time,r=a.Username;switch(e){case t:return{tessedit_char_whitelist:z,tessedit_pageseg_mode:q};case r:return{tessedit_char_whitelist:I,tessedit_pageseg_mode:X};case n:default:return{tessedit_char_whitelist:H,tessedit_pageseg_mode:X}}},J=function(e,t){return Math.floor(e*t)},L=function(e,t){for(var n=e.charCodeAt(0),a=t.charCodeAt(0),r=[],c=n;c<=a;c+=1)r.push(String.fromCharCode(c));return r},R=8,B=L("A","Z").join(""),F=L("a","z").join(""),G="".concat(F).concat(B),W=U(0,9).join(""),z=U(1,R).join(""),H="".concat(W,":-"),I="".concat(G).concat(W,":-_. "),q="10",X="7",Y="\n",Z=1,$=function(){var e=function(e){var t=function(e){var t="".concat(e);return r.createElement("option",{key:e,label:t,value:e},t)};return r.createElement("tbody",null,he[e].map((function(n,a){var c,l,i=n.position,o=n.username,s="".concat(i,"-").concat(o);return r.createElement("tr",{key:s},r.createElement("td",null,i),Pe&&r.createElement("td",null,(c=o,(l=pe)&&S(l).includes(c)?"\ud83d\udc64":"\ud83e\udd16")),r.createElement("td",null,r.createElement("select",{disabled:re,onChange:Me(e,a),value:o},function(){var e=S(pe).sort();if(!Pe)return e.map(t);var n=S(ye).sort();return r.createElement(r.Fragment,null,r.createElement("optgroup",{key:"human",label:"Human"},e.map(t)),r.createElement("optgroup",{key:"cpus",label:"CPUs"},n.map(t)))}())))})))},t=function(t){var n="Race ".concat(t+1),a=function(e){var t={correct:!1,errMsg:""};return e.some((function(e){return!e}))?(t.errMsg="At least one username is missing",t):Object(k.uniq)(e).length!==e.length?(t.errMsg="At least one username is duplicated",t):(t.correct=!0,t)}(he[t].map((function(e){return e.username})));return r.createElement("div",{key:t},r.createElement("h3",null,n),function(e){if(!q||q.length<=e)return null;var t=j.isMobile?"img-show max-width-100":"img-show max-width-45";return r.createElement("img",{alt:"Cropped Results",className:t,src:q[e]})}(t),r.createElement("div",{className:"flex-container results"},function(t){return r.createElement("table",{className:"flex-1"},r.createElement("thead",null,r.createElement("tr",null,r.createElement("th",null,"Position"),Pe&&r.createElement("th",null,"Type"),r.createElement("th",null,"Name"))),e(t))}(t)),!a.correct&&r.createElement("div",{className:"red"},a.errMsg))},n=function(){if(!ke||0===Object.keys(ke).length)return r.createElement("div",{className:"text-center mb"},"Loading CPUs...");var e=Object.keys(ke),t=Ae?"Automatically activated bots because ".concat(_e," human player(s) was/were filled out of a total of ").concat(D," players"):"Check this if there were bots during the race";return r.createElement(r.Fragment,null,r.createElement("div",{className:"text-center mb"},r.createElement("input",{name:"includeCpuPlayers",type:"checkbox",checked:Pe,onChange:Je,disabled:Ae}),r.createElement("div",{className:"ml inline"},t)),Pe&&r.createElement(r.Fragment,null,r.createElement("div",{className:"text-center mb"},"Bots are automatically determined based on the language and cannot be edited"),r.createElement("div",{className:"inline mr"},"Language in images"),r.createElement("select",{disabled:re,onChange:Ue,value:ee},e.map((function(e){var t="".concat(e);return r.createElement("option",{key:e,label:t,value:e},t)}))),r.createElement("textarea",{className:"textarea-".concat(Re),disabled:!0,placeholder:"Loading CPUs...",rows:R,value:ye})))},c=function(){var e=Object(h.a)(m.a.mark((function e(){return m.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:se(!0),ce(!1),fetch("https://sebranly.github.io/json/ctrocr/players.json").then((function(e){return e.json()})).then((function(e){Ne(e),we(P(e.en))}));case 3:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),l=function(){var e=Object(h.a)(m.a.mark((function e(){var t,n,r,c,l,i,o,u,f;return m.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(oe){e.next=2;break}return e.abrupt("return");case 2:return ce(!0),N(.01),fe([]),X([]),t=Object(d.createScheduler)(),n=Object(d.createWorker)({}),t.addWorker(n),e.next=11,n.load();case 11:return N(C(1/4)),e.next=14,n.loadLanguage("eng");case 14:return N(C(.5)),e.next=17,n.initialize("eng");case 17:return N(C(3/4)),r=M(a.Username),e.next=21,n.setParameters(r);case 21:N(C(1)),c=U(0,D-1),l=function(){var e=Object(h.a)(m.a.mark((function e(n,a,r,c){var l,i,o,s,u,h,f,d,g;return m.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return l=t,i=T(r,n,a),o=c.crop(i.left,i.top,i.width,i.height),s={count:2,type:"image/jpeg"},e.next=6,o.getBufferAsync("image/jpeg");case 6:return u=e.sent,e.next=9,p()(u,s).then((function(e){return[e[0].rgb(),e[1].rgb()]}));case 9:return h=e.sent,f=h[0][0]<h[1][0]&&h[0][1]<h[1][1]&&h[0][2]<h[1][2],d=f?o.invert():o,e.next=14,d.getBufferAsync("image/jpeg");case 14:return g=e.sent,e.abrupt("return",l.addJob("recognize",g));case 16:case"end":return e.stop()}}),e)})));return function(t,n,a,r){return e.apply(this,arguments)}}(),i=[],o=[],u=m.a.mark((function e(t){var n,r,u,h,f,d,g,p,b,E,y,w;return m.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=void 0,e.prev=1,e.next=4,v.a.read(W[t]);case 4:return r=e.sent,n=r.rotate(-6.2),u=n.bitmap.width,h=n.bitmap.height,d=T(f={width:u,height:h},D,a.All),g=n.clone(),g.crop(d.left,d.top,d.width,d.height).getBase64("image/jpeg",(function(e,t){o=[].concat(Object(s.a)(o),[t])})),p=c.map((function(e){return l(e,a.Username,f,n.grayscale().clone())})),N(C(1,t,W.length)),e.next=17,Promise.all(p);case 17:b=e.sent,E=b.map((function(e){return e.data.text.replace(/\n/g,"").replace(/ /g,"")})),y=[],w=_(pe,ye,Pe),c.forEach((function(e){var t=E[e],n={username:A(t,w),position:e+1};y.push(n)})),i=[].concat(Object(s.a)(i),[y]),e.next=28;break;case 25:e.prev=25,e.t0=e.catch(1),ce(!1);case 28:case"end":return e.stop()}}),e,null,[[1,25]])})),f=0;case 28:if(!(f<W.length)){e.next=33;break}return e.delegateYield(u(f),"t0",30);case 30:f++,e.next=28;break;case 33:return fe(i),X(o),N(1),ce(!1),e.next=39,t.terminate();case 39:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),i=y()(),u=i.width,g=i.height,b=r.useState(0),E=Object(o.a)(b,2),w=E[0],N=E[1],O=r.useState([]),J=Object(o.a)(O,2),L=J[0],B=J[1],F=r.useState([]),G=Object(o.a)(F,2),W=G[0],z=G[1],H=r.useState([]),I=Object(o.a)(H,2),q=I[0],X=I[1],Y=r.useState(R),$=Object(o.a)(Y,2),D=$[0],K=$[1],Q=r.useState("en"),V=Object(o.a)(Q,2),ee=V[0],te=V[1],ne=r.useState(!0),ae=Object(o.a)(ne,2),re=ae[0],ce=ae[1],le=r.useState(!1),ie=Object(o.a)(le,2),oe=ie[0],se=ie[1],ue=r.useState([]),me=Object(o.a)(ue,2),he=me[0],fe=me[1],de=r.useState(""),ge=Object(o.a)(de,2),pe=ge[0],be=ge[1],ve=r.useState("Loading CPUs..."),Ee=Object(o.a)(ve,2),ye=Ee[0],we=Ee[1],xe=r.useState({}),je=Object(o.a)(xe,2),ke=je[0],Ne=je[1],Oe=r.useState(!1),Ce=Object(o.a)(Oe,2),Pe=Ce[0],Se=Ce[1],_e=S(pe).length,Ae=_e<D;r.useEffect((function(){c()}),[]),r.useEffect((function(){if(!(L.length<1)){var e=[];Object(k.sortBy)(L,(function(e){return e.name})).forEach((function(t){return e.push(URL.createObjectURL(t))})),z(e)}}),[L]),r.useEffect((function(){Ae&&!Pe&&Se(!0)}),[Ae,Pe]);var Te=function(e){B(Object(s.a)(e.target.files)),fe([])},Ue=function(e){te(e.target.value),we(P(ke[e.target.value]))},Me=function(e,t){return function(n){if(he&&!(he.length<e)){var a=Object(s.a)(he);a[e][t].username=n.target.value,fe(a)}}},Je=function(e){Se(e.target.checked)},Le=U(2,R),Re=j.isMobile?"mobile":"desktop",Be=re?"bg-grey":"bg-white";return r.createElement(f.b,null,r.createElement(f.a,null,r.createElement("title",null,"Crash Team Reading"),r.createElement("link",{rel:"canonical",href:"https://sebranly.github.io/ctr-ocr"})),r.createElement("div",{className:"main"},r.createElement("h1",null,"Crash Team Reading"),r.createElement("div",{className:"w3-light-grey"}),w===Z&&r.createElement(x.a,{width:u,height:g,numberOfPieces:800,recycle:!1}),r.createElement("div",{className:"center main-content-".concat(Re," ").concat(Be)},function(){if([0,Z].includes(w))return null;var e=Math.floor(100*w),t="".concat(e,"%");return r.createElement("div",{className:"progress-bar sticky"},r.createElement("div",{className:"pl progress",style:{maxWidth:t}},t))}(),r.createElement("h2",null,"Players"),r.createElement("h3",null,"Number of players"),r.createElement("div",{className:"text-center mb"},"This includes CPUs if any"),r.createElement("select",{disabled:re,onChange:function(e){K(Number(e.target.value))},value:D},Le.map((function(e){var t="".concat(e," players");return r.createElement("option",{key:e,label:t,value:e},t)}))),r.createElement("h3",null,"Human Players"),r.createElement("div",{className:"text-center mb"},"Type all human players present in the races. Type one username per line."),r.createElement("textarea",{className:"textarea-".concat(Re),disabled:re,placeholder:"Hy\xe8ne_JurassX\nAlexiz\nColonel_Hay\nTATANE",rows:D,value:pe,onChange:function(e){be(e.currentTarget.value)}}),0===_e?null:r.createElement(r.Fragment,null,r.createElement(r.Fragment,null,r.createElement("h3",null,"CPUs"),n()),r.createElement("h2",null,"Images"),r.createElement("div",{className:"text-center mb"},r.createElement("div",{className:"ml block mb"},"Select screenshots in JPEG format, taken right when Returning to Lobby was around 14 seconds"),r.createElement("div",{className:"ml block mb"},"Screenshots will be ordered alphabetically by name"),r.createElement("div",{className:"ml block mb"},"An example:"," ",r.createElement("a",{href:"https://raw.githubusercontent.com/sebranly/ctr-ocr/main/src/img/input/IMG1.JPG",rel:"noopener noreferrer",title:"Example of valid JPEG screenshot",target:"_blank"},"Example of valid JPEG screenshot")),r.createElement("input",{className:"inline",disabled:re,type:"file",multiple:!0,accept:"image/jpeg",onChange:Te}),r.createElement("input",{className:"inline-block ml",type:"button",value:"Start recognition",disabled:re||!W||0===W.length,onClick:l})),j.isMobile?W.map((function(e,t){return r.createElement("img",{alt:"tbd",className:"img-full max-width-100 block",key:"".concat(e,"-").concat(t),src:e})})):r.createElement("div",{className:"flex-container center"},W.map((function(e,t){return r.createElement("img",{alt:"tbd",className:"img-full max-width-45 flex-1",key:"".concat(e,"-").concat(t),src:e})}))),he&&0!==he.length?r.createElement(r.Fragment,null,r.createElement("div",{className:"center"},r.createElement("h2",null,"Results"),he.map((function(e,n){return t(n)})))):null)),r.createElement("div",{className:"mt2 text-center"},"v".concat("1.0.0"))))};Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));i.a.render(c.a.createElement(c.a.StrictMode,null,c.a.createElement($,null),","),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then((function(e){e.unregister()})).catch((function(e){console.error(e.message)}))}},[[146,1,2]]]);
//# sourceMappingURL=main.9c1ac007.chunk.js.map