(this["webpackJsonpctr-ocr"]=this["webpackJsonpctr-ocr"]||[]).push([[0],{140:function(e,t,n){e.exports=n(376)},145:function(e,t,n){},146:function(e,t,n){},184:function(e,t){},186:function(e,t){},213:function(e,t){},376:function(e,t,n){"use strict";n.r(t);var r=n(2),a=n.n(r),i=n(134),o=n.n(i),c=(n(145),n(31)),s=n(46),u=n(8),g=n.n(u),l=n(45),m=(n(146),n(72)),h=n(18),f=n(137),d=n.n(f),p=n(138),b=n.n(p),v=n(139),w=n.n(v),x=function(e,t){var n=1/0,r=e;return t.forEach((function(t){var a=w.a.get(e,t);a<n&&(n=a,r=t)})),r},y=function(e,t){for(var n=[],r=e;r<=t;r+=1)n.push(r);return n},j=function(e,t){return Math.round(e*t)},E=function(e,t){for(var n=e.charCodeAt(0),r=t.charCodeAt(0),a=[],i=n;i<=r;i+=1)a.push(String.fromCharCode(i));return a},k=E("A","Z").join(""),O=E("a","z").join(""),_="".concat(O).concat(k),S=y(0,9).join(""),C=y(1,8).join(""),z="".concat(S,":-"),A="".concat(_).concat(S,":-_."),L=["caso-pyro01","stin_wz","ZouGui28","francois24540","DGregson97","nessanumen","AlexKenshin_33","CrazyLittleJazzy","mmartin_m","Dr N. Tropy","Kity_Panda","Jakubeq1_","Assistant de laboratoire","B\xe9b\xe9 N. Tropy","Faux Crash","giomastik","MarioAlfie123","kimmyy043","Mav15151515","Axe34070","Stew"],B=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2?arguments[2]:void 0,r=e.width,a=e.height,i=j(.64,r),o=j(.265,a),c=j(.27,r),s=j(.425,a),u=.73,g=.03,l=.27,m=.1,h=1-u-g,f={top:j(t/8,s),height:j(1/8,s)},d=o+f.top,p=f.height,b=i+j(u,c),v=j(h,c),w=i+j(l,c),x=j(1-h-l-g,c);if("position"===n){var y={left:i,top:d,width:j(m,c),height:p};return y}var E="time"===n,k=E?b:w,O=E?v:x,_={left:k,top:d,width:O,height:p};return _},I=function(){var e=function(){var e=Object(l.a)(g.a.mark((function e(){return g.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:k(!0),v(!1);case 2:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),t=function(){var e=Object(l.a)(g.a.mark((function e(){var t,n,r,a,i,c,u,m,f,p,w,j,k,O,_,I,P,J,W,R,G,M,N,T;return g.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(E){e.next=2;break}return e.abrupt("return");case 2:return v(!0),t=Object(h.createScheduler)(),n=Object(h.createScheduler)(),r=Object(h.createScheduler)(),a=Object(h.createWorker)({logger:function(e){return console.log(e)}}),i=Object(h.createWorker)({logger:function(e){return console.log(e)}}),c=Object(h.createWorker)({logger:function(e){return console.log(e)}}),t.addWorker(a),n.addWorker(i),r.addWorker(c),(u=document.getElementById("img-show"))&&(u.innerHTML=""),o("Loading engine for position"),e.next=17,c.load();case 17:return o("Loading engine for username"),e.next=20,i.load();case 20:return o("Loading engine for time"),e.next=23,a.load();case 23:return o("Loading language for position"),e.next=26,c.loadLanguage("eng");case 26:return o("Loading language for username"),e.next=29,i.loadLanguage("eng");case 29:return o("Loading language for time"),e.next=32,a.loadLanguage("eng");case 32:return o("Initializing engine for position"),e.next=35,c.initialize("eng");case 35:return o("Initializing engine for username"),e.next=38,i.initialize("eng");case 38:return o("Initializing engine for time"),e.next=41,a.initialize("eng");case 41:return o("Setting parameter for position"),e.next=44,c.setParameters({tessedit_char_whitelist:C,tessedit_pageseg_mode:"10"});case 44:return o("Setting parameter for username"),e.next=47,i.setParameters({tessedit_char_whitelist:A,tessedit_pageseg_mode:"7"});case 47:return o("Setting parameter for time"),e.next=50,a.setParameters({tessedit_char_whitelist:z,tessedit_pageseg_mode:"7"});case 50:return m=y(0,7),f=function(){var e=Object(l.a)(g.a.mark((function e(a,i,o,c){var s,u,l,m,h,f,p,b,v,x;return g.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return s=w.clone(),u=null,u="time"===i?t:"pseudo"===i?n:r,l=B(o,a,i),m=s.crop(l.left,l.top,l.width,l.height),h={count:2,type:"image/jpeg"},e.next=8,m.getBufferAsync("image/jpeg");case 8:return f=e.sent,e.next=11,d()(f,h).then((function(e){return console.log("\ud83d\ude80 ~ rgb ~ colors",a,e),[e[0].rgb(),e[1].rgb()]}));case 11:return p=e.sent,b=p[0][0]<p[1][0]&&p[0][1]<p[1][1]&&p[0][2]<p[1][2],(v=b?m.invert():m).getBase64("image/jpeg",(function(e,t){var n=document.createElement("img");n.setAttribute("src",t);var r=document.getElementById("img-show");r&&r.appendChild(n)})),e.next=17,v.getBufferAsync("image/jpeg");case 17:return x=e.sent,e.abrupt("return",u.addJob("recognize",x));case 19:case"end":return e.stop()}}),e)})));return function(t,n,r,a){return e.apply(this,arguments)}}(),p="https://raw.githubusercontent.com/sebranly/ctr-ocr/main/src/img/input/IMG".concat(S,".JPG"),o("Reading the image"),e.prev=54,e.next=57,b.a.read(p);case 57:return j=e.sent,o("Rotating the image"),(w=j.rotate(-6.2).grayscale()).getBase64("image/jpeg",(function(e,t){var n=document.createElement("img");n.setAttribute("src",t);var r=document.getElementById("img-show");r&&r.appendChild(n)})),k=w.bitmap.width,O=w.bitmap.height,_={width:k,height:O},console.log("info.width",_.width,"info.height",_.height),I=m.map((function(e){return f(e,"position",_,w)})),P=m.map((function(e){return f(e,"pseudo",_,w)})),J=m.map((function(e){return f(e,"time",_,w)})),o("Starting text recognition"),e.next=71,Promise.all([].concat(Object(s.a)(I),Object(s.a)(P),Object(s.a)(J)));case 71:return W=e.sent,R=W.map((function(e){return e.data.text.replace(/\n/g,"").replace(/ /g,"")})),G=R.slice(0,8),console.log("\ud83d\ude80 ~ file: App.tsx ~ line 269 ~ doOCR ~ resultsPositions",G),M=R.slice(8,16),N=R.slice(16),T=[],m.forEach((function(e){var t=M[e],n={g:t,position:G[e],player:x(t,L),time:N[e]};T.push(n)})),o(JSON.stringify(T)),v(!1),e.next=83,t.terminate();case 83:return e.next=85,n.terminate();case 85:return e.next=87,r.terminate();case 87:e.next=93;break;case 89:e.prev=89,e.t0=e.catch(54),o("Unable to open image ".concat(e.t0.toString(),". Please restart.")),v(!1);case 93:case"end":return e.stop()}}),e,null,[[54,89]])})));return function(){return e.apply(this,arguments)}}(),n=r.useState("Pick an image"),a=Object(c.a)(n,2),i=a[0],o=a[1],u=r.useState(!0),f=Object(c.a)(u,2),p=f[0],v=f[1],w=r.useState(!1),j=Object(c.a)(w,2),E=j[0],k=j[1],O=r.useState(1),_=Object(c.a)(O,2),S=_[0],I=_[1];r.useEffect((function(){t()}),[S]),r.useEffect((function(){e()}),[]);var P="https://raw.githubusercontent.com/sebranly/ctr-ocr/main/src/img/input/IMG".concat(S,".JPG"),J=y(1,5);return r.createElement(m.b,null,r.createElement(m.a,null,r.createElement("title",null,"CTR OCR"),r.createElement("link",{rel:"canonical",href:"https://sebranly.github.io/ctr-ocr"})),r.createElement("div",{className:"main"},r.createElement("h1",{className:"white"},"CTR OCR"),r.createElement("select",{disabled:p,onChange:function(e){I(Number(e.target.value))}},J.map((function(e){return r.createElement("option",{key:e,label:e.toString(),value:e},"Image ",e)}))),r.createElement("img",{alt:"Example ".concat(S),src:P}),r.createElement("div",null,i),r.createElement("div",{id:"img-show"})))};Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));o.a.render(a.a.createElement(I,null),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then((function(e){e.unregister()})).catch((function(e){console.error(e.message)}))}},[[140,1,2]]]);
//# sourceMappingURL=main.964eff8e.chunk.js.map