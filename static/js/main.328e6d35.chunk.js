(this["webpackJsonpctr-ocr"]=this["webpackJsonpctr-ocr"]||[]).push([[0],{146:function(e,t,n){e.exports=n(386)},151:function(e,t,n){},152:function(e,t,n){},190:function(e,t){},192:function(e,t){},219:function(e,t){},386:function(e,t,n){"use strict";n.r(t);var a,r=n(0),c=n.n(r),i=n(136),o=n.n(i),s=(n(151),n(31)),l=n(9),u=n(8),m=n.n(u),h=n(45),g=(n(152),n(72)),f=n(74);!function(e){e.Position="position",e.Time="time",e.Username="username",e.All="all"}(a||(a={}));var d=n(139),p=n.n(d),v=n(140),b=n.n(v),E=n(145),w=n.n(E),x=n(141),j=n.n(x),y=n(142),O=n(143),k=n.n(O),N=(n(144),function(e,t){var n=t.filter((function(e){return!!e})),a=1/0,r=e;return n.forEach((function(t){var n=k.a.get(e,t);n<a&&(a=n,r=t)})),r}),C=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2?arguments[2]:void 0,r=e.width,c=e.height,i=P(.64,r),o=P(.265,c),s=P(.27,r),l=P(.425,c);if(n===a.All){var u={height:l,left:i,top:o,width:s};return u}var m=.73,h=.03,g=.27,f=.1,d=1-m-h,p={top:P(t/8,l),height:P(1/8,l)},v=o+p.top,b=p.height;if(n===a.Position){var E={height:b,left:i,top:v,width:P(f,s)};return E}var w=i+P(m,s),x=P(d,s),j=i+P(g,s),y=P(1-d-g-h,s),O=n===a.Time,k=O?w:j,N=O?x:y,C={height:b,left:k,top:v,width:N};return C},S=function(e,t){for(var n=[],a=e;a<=t;a+=1)n.push(a);return n},_=function(e){var t=a.Position,n=a.Time,r=a.Username;switch(e){case t:return{tessedit_char_whitelist:R,tessedit_pageseg_mode:U};case r:return{tessedit_char_whitelist:J,tessedit_pageseg_mode:z};case n:default:return{tessedit_char_whitelist:G,tessedit_pageseg_mode:z}}},P=function(e,t){return Math.floor(e*t)},A=function(e,t){for(var n=e.charCodeAt(0),a=t.charCodeAt(0),r=[],c=n;c<=a;c+=1)r.push(String.fromCharCode(c));return r},B=A("A","Z").join(""),T=A("a","z").join(""),I="".concat(T).concat(B),M=S(0,9).join(""),R=S(1,8).join(""),G="".concat(M,":-"),J="".concat(I).concat(M,":-_. "),U="10",z="7",L=function(){var e=function(e){var t=e>E?"-off":"",n="".concat(4===e?"green":"red").concat(t),a="dot ".concat(n);return r.createElement("span",{key:e,className:a})},t=function(){return q?r.createElement("tbody",null,q.map((function(e){var t=e.position,n=e.username,a=e.time,c="".concat(t,"-").concat(n,"-").concat(a);return r.createElement("tr",{key:c},r.createElement("td",null,t),r.createElement("td",null,n))}))):null},n=function(){var e=Object(h.a)(m.a.mark((function e(){return m.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:U(!0),M(!1);case 2:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),c=function(){var e=Object(h.a)(m.a.mark((function e(){var t,n,r,c,i,o,s,l,u,g,d,v,E,w,j,y,O,k,P;return m.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(J){e.next=2;break}return e.abrupt("return");case 2:return M(!0),x(0),D(void 0),t=Object(f.createScheduler)(),n=Object(f.createWorker)({}),t.addWorker(n),(r=document.getElementsByClassName("img-show")[0])&&(r.innerHTML=""),x(1),A("Loading engine (1/4)"),e.next=14,n.load();case 14:return A("Loading language (2/4)"),e.next=17,n.loadLanguage("eng");case 17:return A("Initializing engine (3/4)"),e.next=20,n.initialize("eng");case 20:return A("Setting parameter (4/4)"),c=_(a.Username),e.next=24,n.setParameters(c);case 24:return i=S(0,7),o=function(){var e=Object(h.a)(m.a.mark((function e(n,a,r,c){var i,o,s,l,u,h,g,f,d,v;return m.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return i=c.clone(),o=t,s=C(r,n,a),l=i.crop(s.left,s.top,s.width,s.height),u={count:2,type:"image/jpeg"},e.next=7,l.getBufferAsync("image/jpeg");case 7:return h=e.sent,e.next=10,p()(h,u).then((function(e){return[e[0].rgb(),e[1].rgb()]}));case 10:return g=e.sent,f=g[0][0]<g[1][0]&&g[0][1]<g[1][1]&&g[0][2]<g[1][2],d=f?l.invert():l,e.next=15,d.getBufferAsync("image/jpeg");case 15:return v=e.sent,e.abrupt("return",o.addJob("recognize",v));case 17:case"end":return e.stop()}}),e)})));return function(t,n,a,r){return e.apply(this,arguments)}}(),s="https://raw.githubusercontent.com/sebranly/ctr-ocr/main/src/img/input/IMG".concat(W,".JPG"),x(2),A("Reading the image"),e.prev=29,e.next=32,b.a.read(s);case 32:return u=e.sent,A("Generating cropped image"),l=u.rotate(-6.2).grayscale(),g=l.bitmap.width,d=l.bitmap.height,E=C(v={width:g,height:d},0,a.All),w=l.clone(),w.crop(E.left,E.top,E.width,E.height).getBase64("image/jpeg",(function(e,t){var n=document.createElement("img");n.setAttribute("src",t);var a=document.getElementsByClassName("img-show")[0];a&&a.appendChild(n)})),j=i.map((function(e){return o(e,a.Username,v,l)})),A("Starting text recognition"),x(3),e.next=47,Promise.all(j);case 47:return y=e.sent,O=y.map((function(e){return e.data.text.replace(/\n/g,"").replace(/ /g,"")})),k=[],P=Q.split("\n"),i.forEach((function(e){var t=O[e],n={username:N(t,P),position:e+1};k.push(n)})),D(k),A("Recognition is done and successful"),x(4),M(!1),e.next=58,t.terminate();case 58:e.next=64;break;case 60:e.prev=60,e.t0=e.catch(29),A("Unable to open image ".concat(e.t0.toString(),". Please restart.")),M(!1);case 64:case"end":return e.stop()}}),e,null,[[29,60]])})));return function(){return e.apply(this,arguments)}}(),i=w()(),o=i.width,u=i.height,d=r.useState(0),v=Object(l.a)(d,2),E=v[0],x=v[1],O=r.useState(""),k=Object(l.a)(O,2),P=k[0],A=k[1],B=r.useState(!0),T=Object(l.a)(B,2),I=T[0],M=T[1],R=r.useState(!1),G=Object(l.a)(R,2),J=G[0],U=G[1],z=r.useState(1),L=Object(l.a)(z,2),W=L[0],H=L[1],Z=r.useState(void 0),$=Object(l.a)(Z,2),q=$[0],D=$[1],F=r.useState(""),K=Object(l.a)(F,2),Q=K[0],V=K[1];r.useEffect((function(){c()}),[W]),r.useEffect((function(){n()}),[]);var X="https://raw.githubusercontent.com/sebranly/ctr-ocr/main/src/img/input/IMG".concat(W,".JPG"),Y=[].concat(Object(s.a)(S(1,5)),Object(s.a)(S(11,20))),ee=y.isMobile?"mobile":"desktop";return r.createElement(g.b,null,r.createElement(g.a,null,r.createElement("title",null,"Crash Team Racing: OCR"),r.createElement("link",{rel:"canonical",href:"https://sebranly.github.io/ctr-ocr"})),r.createElement("div",{className:"main"},r.createElement("h1",{className:"white"},"Crash Team Racing: OCR"),4===E&&r.createElement(j.a,{width:o,height:u,numberOfPieces:400,recycle:!1}),r.createElement("div",{className:"main-content-".concat(ee)},r.createElement("div",{className:"dots"},S(1,4).map(e)),r.createElement("div",{className:"ocr"},P),r.createElement("h2",null,"Players"),r.createElement("h3",null,"One player per line"),r.createElement("textarea",{className:"textarea-".concat(ee),rows:8,value:Q,onChange:function(e){V(e.currentTarget.value)}}),r.createElement("div",{className:"flex-container results"},q?r.createElement("table",{className:"flex-1"},r.createElement("thead",null,r.createElement("tr",null,r.createElement("th",null,"Position"),r.createElement("th",null,"Name"))),t()):null),r.createElement("h2",null,"Image"),r.createElement("div",{className:"img-show"}),r.createElement("div",{className:"center"},r.createElement("select",{disabled:I,onChange:function(e){H(Number(e.target.value))}},Y.map((function(e){var t="Image ".concat(e);return r.createElement("option",{key:e,label:t,value:e},t)})))),r.createElement("img",{id:"img-full",alt:"Example ".concat(W),src:X}))))};Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));o.a.render(c.a.createElement(c.a.StrictMode,null,c.a.createElement(L,null),","),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then((function(e){e.unregister()})).catch((function(e){console.error(e.message)}))}},[[146,1,2]]]);
//# sourceMappingURL=main.328e6d35.chunk.js.map