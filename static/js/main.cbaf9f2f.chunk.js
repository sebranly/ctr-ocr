(this["webpackJsonpctr-ocr"]=this["webpackJsonpctr-ocr"]||[]).push([[0],{146:function(e,t,n){e.exports=n(386)},151:function(e,t,n){},152:function(e,t,n){},190:function(e,t){},192:function(e,t){},219:function(e,t){},386:function(e,t,n){"use strict";n.r(t);var a,r=n(0),c=n.n(r),i=n(137),l=n.n(i),o=(n(151),n(19)),s=n(7),u=n(9),m=n.n(u),h=n(45),g=(n(152),n(72)),d=n(74);!function(e){e.Position="position",e.Time="time",e.Username="username",e.All="all"}(a||(a={}));var f=n(140),p=n.n(f),v=n(141),b=n.n(v),E=n(145),y=n.n(E),w=n(142),x=n.n(w),j=n(75),N=n(143),k=n.n(N),O=(n(144),function(e){return e&&0!==e.length?e.filter((function(e){return!!e})).sort().join(X):""}),C=function(e){return e?e.split(X).filter((function(e){return!!e})):[]},S=function(e,t,n){if(!e)return[];var a=C(e);if(!n||!t)return a;var r=C(t);return[].concat(Object(o.a)(a),Object(o.a)(r))},P=function(e,t){var n=t.filter((function(e){return!!e})),a=1/0,r=e;return n.forEach((function(t){var n=k.a.get(e,t);n<a&&(a=n,r=t)})),r},_=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2?arguments[2]:void 0,r=e.width,c=e.height,i=U(.64,r),l=U(.265,c),o=U(.27,r),s=U(.425,c);if(n===a.All){var u=t/L,m={height:U(u,s),left:i,top:l,width:o};return m}var h=.73,g=.03,d=.27,f=.1,p=1-h-g,v={top:U(t/8,s),height:U(1/8,s)},b=l+v.top,E=v.height;if(n===a.Position){var y={height:E,left:i,top:b,width:U(f,o)};return y}var w=i+U(h,o),x=U(p,o),j=i+U(d,o),N=U(1-p-d-g,o),k=n===a.Time,O=k?w:j,C=k?x:N,S={height:E,left:O,top:b,width:C};return S},A=function(e,t){for(var n=[],a=e;a<=t;a+=1)n.push(a);return n},T=function(e){var t=a.Position,n=a.Time,r=a.Username;switch(e){case t:return{tessedit_char_whitelist:F,tessedit_pageseg_mode:R};case r:return{tessedit_char_whitelist:H,tessedit_pageseg_mode:W};case n:default:return{tessedit_char_whitelist:G,tessedit_pageseg_mode:W}}},U=function(e,t){return Math.floor(e*t)},B=function(e,t){for(var n=e.charCodeAt(0),a=t.charCodeAt(0),r=[],c=n;c<=a;c+=1)r.push(String.fromCharCode(c));return r},L=8,M=B("A","Z").join(""),I=B("a","z").join(""),J="".concat(I).concat(M),z=A(0,9).join(""),F=A(1,L).join(""),G="".concat(z,":-"),H="".concat(J).concat(z,":-_. "),R="10",W="7",X="\n",Z=function(){var e=function(e){var t=e>w?"-off":"",n="".concat(4===e?"green":"red").concat(t),a="dot ".concat(n);return r.createElement("span",{key:e,className:a})},t=function(){return r.createElement("tbody",null,ce.map((function(e){var t=e.position,n=e.username,a=e.time,c="".concat(t,"-").concat(n,"-").concat(a);return r.createElement("tr",{key:c},r.createElement("td",null,t),r.createElement("td",null,n))})))},n=function(){if(!ve||0===Object.keys(ve).length)return r.createElement("div",{className:"text-center mb"},"Loading CPUs...");var e=Object.keys(ve),t=Ne?"Automatically activated bots because ".concat(je," human player(s) was/were filled out of a total of ").concat(z," players"):"Check this if there were bots during the race";return r.createElement(r.Fragment,null,r.createElement("div",{className:"text-center mb"},r.createElement("input",{name:"includeCpuPlayers",type:"checkbox",checked:we,onChange:Ce,disabled:Ne}),r.createElement("div",{className:"ml inline"},t)),we&&r.createElement(r.Fragment,null,r.createElement("div",{className:"text-center mb"},"Bots are automatically determined based on the language and cannot be edited"),r.createElement("div",{className:"inline mr"},"Language in images"),r.createElement("select",{onChange:ke,value:R},e.map((function(e){var t="".concat(e);return r.createElement("option",{key:e,label:t,value:e},t)}))),r.createElement("textarea",{className:"textarea-".concat(Ae),disabled:!0,placeholder:"Loading CPUs...",rows:L,value:ge})))},c=function(){var e=Object(h.a)(m.a.mark((function e(){return m.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:V(!0),q(!1),fetch("https://sebranly.github.io/json/ctrocr/players.json").then((function(e){return e.json()})).then((function(e){be(e),de(O(e.en))}));case 3:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),i=function(){var e=Object(h.a)(m.a.mark((function e(){var t,n,r,c,i,l,o,s,u,g,f,v,E,y,w,x,j,k,O;return m.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(Q){e.next=2;break}return e.abrupt("return");case 2:return q(!0),N(0),ie(void 0),t=Object(d.createScheduler)(),n=Object(d.createWorker)({}),t.addWorker(n),(r=document.getElementsByClassName("img-show")[0])&&(r.innerHTML=""),N(1),M("Loading engine... (1/4)"),e.next=14,n.load();case 14:return M("Loading language... (2/4)"),e.next=17,n.loadLanguage("eng");case 17:return M("Initializing engine... (3/4)"),e.next=20,n.initialize("eng");case 20:return M("Setting parameter... (4/4)"),c=T(a.Username),e.next=24,n.setParameters(c);case 24:return i=A(0,z-1),l=function(){var e=Object(h.a)(m.a.mark((function e(n,a,r,c){var i,l,o,s,u,h,g,d,f,v;return m.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return i=c.clone(),l=t,o=_(r,n,a),s=i.crop(o.left,o.top,o.width,o.height),u={count:2,type:"image/jpeg"},e.next=7,s.getBufferAsync("image/jpeg");case 7:return h=e.sent,e.next=10,p()(h,u).then((function(e){return[e[0].rgb(),e[1].rgb()]}));case 10:return g=e.sent,d=g[0][0]<g[1][0]&&g[0][1]<g[1][1]&&g[0][2]<g[1][2],f=d?s.invert():s,e.next=15,f.getBufferAsync("image/jpeg");case 15:return v=e.sent,e.abrupt("return",l.addJob("recognize",v));case 17:case"end":return e.stop()}}),e)})));return function(t,n,a,r){return e.apply(this,arguments)}}(),o="https://raw.githubusercontent.com/sebranly/ctr-ocr/main/src/img/input/IMG".concat(te,".JPG"),N(2),M("Reading the image..."),e.prev=29,e.next=32,b.a.read(o);case 32:return u=e.sent,M("Generating cropped image..."),s=u.rotate(-6.2),g=s.bitmap.width,f=s.bitmap.height,E=_(v={width:g,height:f},z,a.All),y=s.clone(),y.crop(E.left,E.top,E.width,E.height).getBase64("image/jpeg",(function(e,t){var n=document.createElement("img");n.setAttribute("src",t);var a=document.getElementsByClassName("img-show")[0];a&&a.appendChild(n)})),w=i.map((function(e){return l(e,a.Username,v,s.grayscale())})),M("Starting text recognition..."),N(3),e.next=47,Promise.all(w);case 47:return x=e.sent,j=x.map((function(e){return e.data.text.replace(/\n/g,"").replace(/ /g,"")})),k=[],O=S(se,ge,we),i.forEach((function(e){var t=j[e],n={username:P(t,O),position:e+1};k.push(n)})),ie(k),M(""),N(4),q(!1),e.next=58,t.terminate();case 58:e.next=64;break;case 60:e.prev=60,e.t0=e.catch(29),M("Unable to open image ".concat(e.t0.toString(),". Please restart.")),q(!1);case 64:case"end":return e.stop()}}),e,null,[[29,60]])})));return function(){return e.apply(this,arguments)}}(),l=y()(),u=l.width,f=l.height,v=r.useState(0),E=Object(s.a)(v,2),w=E[0],N=E[1],k=r.useState(""),U=Object(s.a)(k,2),B=U[0],M=U[1],I=r.useState(L),J=Object(s.a)(I,2),z=J[0],F=J[1],G=r.useState("en"),H=Object(s.a)(G,2),R=H[0],W=H[1],X=r.useState(!0),Z=Object(s.a)(X,2),$=Z[0],q=Z[1],D=r.useState(!1),K=Object(s.a)(D,2),Q=K[0],V=K[1],Y=r.useState(1),ee=Object(s.a)(Y,2),te=ee[0],ne=ee[1],ae=r.useState(void 0),re=Object(s.a)(ae,2),ce=re[0],ie=re[1],le=r.useState(""),oe=Object(s.a)(le,2),se=oe[0],ue=oe[1],me=r.useState("Loading CPUs..."),he=Object(s.a)(me,2),ge=he[0],de=he[1],fe=r.useState({}),pe=Object(s.a)(fe,2),ve=pe[0],be=pe[1],Ee=r.useState(!1),ye=Object(s.a)(Ee,2),we=ye[0],xe=ye[1],je=C(se).length,Ne=je<z;r.useEffect((function(){c()}),[]),r.useEffect((function(){Ne&&!we&&xe(!0)}),[Ne,we]);var ke=function(e){W(e.target.value),de(O(ve[e.target.value]))},Oe=function(e){ne(Number(e.target.value))},Ce=function(e){xe(e.target.checked)},Se="https://raw.githubusercontent.com/sebranly/ctr-ocr/main/src/img/input/IMG".concat(te,".JPG"),Pe=[].concat(Object(o.a)(A(1,5)),Object(o.a)(A(11,20))),_e=A(2,L),Ae=j.isMobile?"mobile":"desktop";return r.createElement(g.b,null,r.createElement(g.a,null,r.createElement("title",null,"Crash Team Reading"),r.createElement("link",{rel:"canonical",href:"https://sebranly.github.io/ctr-ocr"})),r.createElement("div",{className:"main"},r.createElement("h1",null,"Crash Team Reading"),4===w&&r.createElement(x.a,{width:u,height:f,numberOfPieces:400,recycle:!1}),r.createElement("div",{className:"center main-content-".concat(Ae)},function(){if(0===w)return null;var t=4===w?"dots":"dots sticky";return r.createElement("div",{className:t},A(1,4).map(e))}(),r.createElement("div",{className:"ocr"},B),r.createElement("h2",null,"Players"),r.createElement("h3",null,"Number of players"),r.createElement("div",{className:"text-center mb"},"This includes CPUs if any"),r.createElement("select",{onChange:function(e){F(Number(e.target.value))},value:z},_e.map((function(e){var t="".concat(e," players");return r.createElement("option",{key:e,label:t,value:e},t)}))),r.createElement("h3",null,"Human Players"),r.createElement("div",{className:"text-center mb"},"Type all human players present in the races. Type one username per line."),r.createElement("textarea",{className:"textarea-".concat(Ae),placeholder:"Hy\xe8ne_JurassX\nAlexiz\nColonel_Hay\nTATANE",rows:z,value:se,onChange:function(e){ue(e.currentTarget.value)}}),0===je?null:r.createElement(r.Fragment,null,r.createElement(r.Fragment,null,r.createElement("h3",null,"CPUs"),n()),!!ce&&r.createElement("div",{className:"center"},r.createElement("h2",null,"Results"),r.createElement("div",{className:"flex-container results"},r.createElement("table",{className:"flex-1"},r.createElement("thead",null,r.createElement("tr",null,r.createElement("th",null,"Position"),r.createElement("th",null,"Name"))),t()))),r.createElement("h2",null,"Image"),r.createElement("div",{className:"center"},r.createElement("select",{disabled:$,onChange:Oe},Pe.map((function(e){var t="Image ".concat(e);return r.createElement("option",{key:e,label:t,value:e},t)}))),r.createElement("input",{className:"inline-block ml",type:"button",value:"Start recognition",disabled:$,onClick:i})),j.isMobile?r.createElement(r.Fragment,null,r.createElement("div",{className:"img-show"}),r.createElement("img",{id:"img-full",alt:"Example ".concat(te),src:Se})):r.createElement("div",{className:"flex-container center"},r.createElement("div",{className:"flex-1"},r.createElement("img",{id:"img-full",alt:"Example ".concat(te),src:Se})),r.createElement("div",{className:"img-show flex-1"})))),r.createElement("div",{className:"mt2 text-center"},"v".concat("1.0.0"))))};Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));l.a.render(c.a.createElement(c.a.StrictMode,null,c.a.createElement(Z,null),","),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then((function(e){e.unregister()})).catch((function(e){console.error(e.message)}))}},[[146,1,2]]]);
//# sourceMappingURL=main.cbaf9f2f.chunk.js.map