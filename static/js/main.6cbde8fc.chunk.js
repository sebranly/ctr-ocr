(this["webpackJsonpctr-ocr"]=this["webpackJsonpctr-ocr"]||[]).push([[0],{146:function(e,t,n){e.exports=n(386)},151:function(e,t,n){},152:function(e,t,n){},190:function(e,t){},192:function(e,t){},219:function(e,t){},386:function(e,t,n){"use strict";n.r(t);var a,r=n(0),c=n.n(r),i=n(137),o=n.n(i),l=(n(151),n(31)),s=n(9),u=n(8),m=n.n(u),h=n(45),g=(n(152),n(72)),p=n(74);!function(e){e.Position="position",e.Time="time",e.Username="username",e.All="all"}(a||(a={}));var d=n(140),f=n.n(d),v=n(141),E=n.n(v),b=n(145),w=n.n(b),x=n(142),y=n.n(x),j=n(75),N=n(143),k=n.n(N),O=(n(144),function(e,t){var n=t.filter((function(e){return!!e})),a=1/0,r=e;return n.forEach((function(t){var n=k.a.get(e,t);n<a&&(a=n,r=t)})),r}),C=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2?arguments[2]:void 0,r=e.width,c=e.height,i=A(.64,r),o=A(.265,c),l=A(.27,r),s=A(.425,c);if(n===a.All){var u=t/T,m={height:A(u,s),left:i,top:o,width:l};return m}var h=.73,g=.03,p=.27,d=.1,f=1-h-g,v={top:A(t/8,s),height:A(1/8,s)},E=o+v.top,b=v.height;if(n===a.Position){var w={height:b,left:i,top:E,width:A(d,l)};return w}var x=i+A(h,l),y=A(f,l),j=i+A(p,l),N=A(1-f-p-g,l),k=n===a.Time,O=k?x:j,C=k?y:N,S={height:b,left:O,top:E,width:C};return S},S=function(e,t){for(var n=[],a=e;a<=t;a+=1)n.push(a);return n},_=function(e){var t=a.Position,n=a.Time,r=a.Username;switch(e){case t:return{tessedit_char_whitelist:R,tessedit_pageseg_mode:U};case r:return{tessedit_char_whitelist:G,tessedit_pageseg_mode:L};case n:default:return{tessedit_char_whitelist:z,tessedit_pageseg_mode:L}}},A=function(e,t){return Math.floor(e*t)},P=function(e,t){for(var n=e.charCodeAt(0),a=t.charCodeAt(0),r=[],c=n;c<=a;c+=1)r.push(String.fromCharCode(c));return r},T=8,B=P("A","Z").join(""),M=P("a","z").join(""),I="".concat(M).concat(B),J=S(0,9).join(""),R=S(1,T).join(""),z="".concat(J,":-"),G="".concat(I).concat(J,":-_. "),U="10",L="7",W=function(){var e=function(e){var t=e>b?"-off":"",n="".concat(4===e?"green":"red").concat(t),a="dot ".concat(n);return r.createElement("span",{key:e,className:a})},t=function(){return r.createElement("tbody",null,Q.map((function(e){var t=e.position,n=e.username,a=e.time,c="".concat(t,"-").concat(n,"-").concat(a);return r.createElement("tr",{key:c},r.createElement("td",null,t),r.createElement("td",null,n))})))},n=function(){var e=Object(h.a)(m.a.mark((function e(){return m.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:F(!0),U(!1);case 2:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),c=function(){var e=Object(h.a)(m.a.mark((function e(){var t,n,r,c,i,o,l,s,u,g,d,v,b,w,y,j,N,k,A;return m.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(H){e.next=2;break}return e.abrupt("return");case 2:return U(!0),x(0),V(void 0),t=Object(p.createScheduler)(),n=Object(p.createWorker)({}),t.addWorker(n),(r=document.getElementsByClassName("img-show")[0])&&(r.innerHTML=""),x(1),P("Loading engine... (1/4)"),e.next=14,n.load();case 14:return P("Loading language... (2/4)"),e.next=17,n.loadLanguage("eng");case 17:return P("Initializing engine... (3/4)"),e.next=20,n.initialize("eng");case 20:return P("Setting parameter... (4/4)"),c=_(a.Username),e.next=24,n.setParameters(c);case 24:return i=S(0,I-1),o=function(){var e=Object(h.a)(m.a.mark((function e(n,a,r,c){var i,o,l,s,u,h,g,p,d,v;return m.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return i=c.clone(),o=t,l=C(r,n,a),s=i.crop(l.left,l.top,l.width,l.height),u={count:2,type:"image/jpeg"},e.next=7,s.getBufferAsync("image/jpeg");case 7:return h=e.sent,e.next=10,f()(h,u).then((function(e){return[e[0].rgb(),e[1].rgb()]}));case 10:return g=e.sent,p=g[0][0]<g[1][0]&&g[0][1]<g[1][1]&&g[0][2]<g[1][2],d=p?s.invert():s,e.next=15,d.getBufferAsync("image/jpeg");case 15:return v=e.sent,e.abrupt("return",o.addJob("recognize",v));case 17:case"end":return e.stop()}}),e)})));return function(t,n,a,r){return e.apply(this,arguments)}}(),l="https://raw.githubusercontent.com/sebranly/ctr-ocr/main/src/img/input/IMG".concat($,".JPG"),x(2),P("Reading the image..."),e.prev=29,e.next=32,E.a.read(l);case 32:return u=e.sent,P("Generating cropped image..."),s=u.rotate(-6.2),g=s.bitmap.width,d=s.bitmap.height,b=C(v={width:g,height:d},I,a.All),w=s.clone(),w.crop(b.left,b.top,b.width,b.height).getBase64("image/jpeg",(function(e,t){var n=document.createElement("img");n.setAttribute("src",t);var a=document.getElementsByClassName("img-show")[0];a&&a.appendChild(n)})),y=i.map((function(e){return o(e,a.Username,v,s.grayscale())})),P("Starting text recognition..."),x(3),e.next=47,Promise.all(y);case 47:return j=e.sent,N=j.map((function(e){return e.data.text.replace(/\n/g,"").replace(/ /g,"")})),k=[],A=te.split("\n"),i.forEach((function(e){var t=N[e],n={username:O(t,A),position:e+1};k.push(n)})),V(k),P(""),x(4),U(!1),e.next=58,t.terminate();case 58:e.next=64;break;case 60:e.prev=60,e.t0=e.catch(29),P("Unable to open image ".concat(e.t0.toString(),". Please restart.")),U(!1);case 64:case"end":return e.stop()}}),e,null,[[29,60]])})));return function(){return e.apply(this,arguments)}}(),i=w()(),o=i.width,u=i.height,d=r.useState(0),v=Object(s.a)(d,2),b=v[0],x=v[1],N=r.useState(""),k=Object(s.a)(N,2),A=k[0],P=k[1],B=r.useState(T),M=Object(s.a)(B,2),I=M[0],J=M[1],R=r.useState(!0),z=Object(s.a)(R,2),G=z[0],U=z[1],L=r.useState(!1),W=Object(s.a)(L,2),H=W[0],F=W[1],X=r.useState(1),Z=Object(s.a)(X,2),$=Z[0],q=Z[1],D=r.useState(void 0),K=Object(s.a)(D,2),Q=K[0],V=K[1],Y=r.useState(""),ee=Object(s.a)(Y,2),te=ee[0],ne=ee[1];r.useEffect((function(){n()}),[]);var ae="https://raw.githubusercontent.com/sebranly/ctr-ocr/main/src/img/input/IMG".concat($,".JPG"),re=[].concat(Object(l.a)(S(1,5)),Object(l.a)(S(11,20))),ce=S(2,T),ie=j.isMobile?"mobile":"desktop";return r.createElement(g.b,null,r.createElement(g.a,null,r.createElement("title",null,"Crash Team Racing: OCR"),r.createElement("link",{rel:"canonical",href:"https://sebranly.github.io/ctr-ocr"})),r.createElement("div",{className:"main"},r.createElement("h1",null,"Crash Team Racing: OCR"),4===b&&r.createElement(y.a,{width:o,height:u,numberOfPieces:400,recycle:!1}),r.createElement("div",{className:"center main-content-".concat(ie)},r.createElement("div",{className:"dots"},S(1,4).map(e)),r.createElement("div",{className:"ocr"},A),r.createElement("h2",null,"Players"),r.createElement("h3",null,"Number of players"),r.createElement("select",{onChange:function(e){J(Number(e.target.value))},value:I},ce.map((function(e){var t="".concat(e," players");return r.createElement("option",{key:e,label:t,value:e},t)}))),r.createElement("h3",null,"Name all players (one per line)"),r.createElement("textarea",{className:"textarea-".concat(ie),placeholder:"Hy\xe8ne_JurassX\nAlexiz\nColonel_Hay\nTATANE",rows:I,value:te,onChange:function(e){ne(e.currentTarget.value)}}),!!Q&&r.createElement("div",{className:"center"},r.createElement("h2",null,"Results"),r.createElement("div",{className:"flex-container results"},r.createElement("table",{className:"flex-1"},r.createElement("thead",null,r.createElement("tr",null,r.createElement("th",null,"Position"),r.createElement("th",null,"Name"))),t()))),r.createElement("h2",null,"Image"),r.createElement("div",{className:"center"},r.createElement("select",{disabled:G,onChange:function(e){q(Number(e.target.value))}},re.map((function(e){var t="Image ".concat(e);return r.createElement("option",{key:e,label:t,value:e},t)}))),r.createElement("input",{className:"inline ml",type:"button",value:"Start recognition",disabled:G,onClick:c})),j.isMobile?r.createElement(r.Fragment,null,r.createElement("div",{className:"img-show"}),r.createElement("img",{id:"img-full",alt:"Example ".concat($),src:ae})):r.createElement("div",{className:"flex-container center"},r.createElement("div",{className:"flex-1"},r.createElement("img",{id:"img-full",alt:"Example ".concat($),src:ae})),r.createElement("div",{className:"img-show flex-1"})))))};Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));o.a.render(c.a.createElement(c.a.StrictMode,null,c.a.createElement(W,null),","),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then((function(e){e.unregister()})).catch((function(e){console.error(e.message)}))}},[[146,1,2]]]);
//# sourceMappingURL=main.6cbde8fc.chunk.js.map