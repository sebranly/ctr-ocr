(this["webpackJsonpctr-ocr"]=this["webpackJsonpctr-ocr"]||[]).push([[0],{140:function(e,t,n){e.exports=n(376)},145:function(e,t,n){},146:function(e,t,n){},184:function(e,t){},186:function(e,t){},213:function(e,t){},376:function(e,t,n){"use strict";n.r(t);var r,a=n(1),i=n.n(a),o=n(134),c=n.n(o),s=(n(145),n(21)),u=n(22),l=n(8),m=n.n(l),g=n(46),d=(n(146),n(72)),h=n(18);!function(e){e.Position="position",e.Time="time",e.Username="username"}(r||(r={}));var f=n(137),p=n.n(f),b=n(138),v=n.n(b),w=n(139),E=n.n(w),x=function(e,t){var n=1/0,r=e;return t.forEach((function(t){var a=E.a.get(e,t);a<n&&(n=a,r=t)})),r},j=function(e,t){for(var n=[],r=e;r<=t;r+=1)n.push(r);return n},y=function(e){var t=r.Position,n=r.Time,a=r.Username;switch(e){case t:return{tessedit_char_whitelist:T,tessedit_pageseg_mode:L};case a:return{tessedit_char_whitelist:A,tessedit_pageseg_mode:B};case n:default:return{tessedit_char_whitelist:z,tessedit_pageseg_mode:B}}},k=function(e,t){return Math.floor(e*t)},O=function(e,t){for(var n=e.charCodeAt(0),r=t.charCodeAt(0),a=[],i=n;i<=r;i+=1)a.push(String.fromCharCode(i));return a},_=O("A","Z").join(""),P=O("a","z").join(""),S="".concat(P).concat(_),C=j(0,9).join(""),T=j(1,8).join(""),z="".concat(C,":-"),A="".concat(S).concat(C,":-_. "),L="10",B="7",I=["caso-pyro01","stin_wz","ZouGui28","francois24540","DGregson97","nessanumen","AlexKenshin_33","CrazyLittleJazzy","mmartin_m","Dr N. Tropy","Kity_Panda","Jakubeq1_","Assistant de laboratoire","B\xe9b\xe9 N. Tropy","Faux Crash","giomastik","MarioAlfie123","kimmyy043","Mav15151515","Axe34070","Stew"],N=/^(0|[1-9]\d{0,}):[0-5]\d:\d\d$/,W=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2?arguments[2]:void 0,a=e.width,i=e.height,o=k(.64,a),c=k(.265,i),s=k(.27,a),u=k(.425,i),l=.73,m=.03,g=.27,d=.1,h=1-l-m,f={top:k(t/8,u),height:k(1/8,u)},p=c+f.top,b=f.height,v=o+k(l,s),w=k(h,s),E=o+k(g,s),x=k(1-h-g-m,s);if(n===r.Position){var j={left:o,top:p,width:k(d,s),height:b};return j}var y=n===r.Time,O=y?v:E,_=y?w:x,P={left:O,top:p,width:_,height:b};return P},J=function(){var e=function(){return B?a.createElement("tbody",null,B.map((function(e){var t=e.position,n=e.username,r=e.time,i="".concat(t,"-").concat(n,"-").concat(r),o=function(e,t){if(!e)return!1;var n=Number(e);return 1===e.length&&n>=1&&n<=t}(t,8)?"\u2705":"\u274c",c=N.test(r)?"\u2705":"\u274c";return a.createElement("tr",{key:i},a.createElement("td",null,o," ",t),a.createElement("td",null,n),a.createElement("td",null,c," ",r))}))):null},t=function(){var e=Object(g.a)(m.a.mark((function e(){return m.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:P(!0),E(!1);case 2:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),n=function(){var e=Object(g.a)(m.a.mark((function e(){var t,n,a,i,o,c,s,d,f,b,w,k,O,P,S,C,z,A,L,B,N,M,R,G,U,D,F;return m.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(_){e.next=2;break}return e.abrupt("return");case 2:return E(!0),J(void 0),t=Object(h.createScheduler)(),n=Object(h.createScheduler)(),a=Object(h.createScheduler)(),i=Object(h.createWorker)({logger:function(e){return console.log(e)}}),o=Object(h.createWorker)({logger:function(e){return console.log(e)}}),c=Object(h.createWorker)({logger:function(e){return console.log(e)}}),t.addWorker(i),n.addWorker(o),a.addWorker(c),(s=document.getElementById("img-show"))&&(s.innerHTML=""),l("Loading engine for position"),e.next=18,c.load();case 18:return l("Loading engine for username"),e.next=21,o.load();case 21:return l("Loading engine for time"),e.next=24,i.load();case 24:return l("Loading language for position"),e.next=27,c.loadLanguage("eng");case 27:return l("Loading language for username"),e.next=30,o.loadLanguage("eng");case 30:return l("Loading language for time"),e.next=33,i.loadLanguage("eng");case 33:return l("Initializing engine for position"),e.next=36,c.initialize("eng");case 36:return l("Initializing engine for username"),e.next=39,o.initialize("eng");case 39:return l("Initializing engine for time"),e.next=42,i.initialize("eng");case 42:return l("Setting parameter for position"),d=y(r.Position),e.next=46,c.setParameters(d);case 46:return l("Setting parameter for username"),f=y(r.Username),e.next=50,o.setParameters(f);case 50:return l("Setting parameter for time"),b=y(r.Time),e.next=54,i.setParameters(b);case 54:return w=j(0,7),k=function(){var e=Object(g.a)(m.a.mark((function e(i,o,c,s){var u,l,g,d,h,f,b,v,w,E;return m.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return u=P.clone(),l=null,l=o===r.Time?t:o===r.Username?n:a,g=W(c,i,o),d=u.crop(g.left,g.top,g.width,g.height),h={count:2,type:"image/jpeg"},e.next=8,d.getBufferAsync("image/jpeg");case 8:return f=e.sent,e.next=11,p()(f,h).then((function(e){return console.log("\ud83d\ude80 ~ rgb ~ colors",i,e),[e[0].rgb(),e[1].rgb()]}));case 11:return b=e.sent,v=b[0][0]<b[1][0]&&b[0][1]<b[1][1]&&b[0][2]<b[1][2],(w=v?d.invert():d).getBase64("image/jpeg",(function(e,t){var n=document.createElement("img");n.setAttribute("src",t);var r=document.getElementById("img-show");r&&r.appendChild(n)})),e.next=17,w.getBufferAsync("image/jpeg");case 17:return E=e.sent,e.abrupt("return",l.addJob("recognize",E));case 19:case"end":return e.stop()}}),e)})));return function(t,n,r,a){return e.apply(this,arguments)}}(),O="https://raw.githubusercontent.com/sebranly/ctr-ocr/main/src/img/input/IMG".concat(T,".JPG"),l("Reading the image"),e.prev=58,e.next=61,v.a.read(O);case 61:return S=e.sent,l("Rotating the image"),(P=S.rotate(-6.2).grayscale()).getBase64("image/jpeg",(function(e,t){var n=document.createElement("img");n.setAttribute("src",t);var r=document.getElementById("img-show");r&&r.appendChild(n)})),C=P.bitmap.width,z=P.bitmap.height,A={width:C,height:z},console.log("info.width",A.width,"info.height",A.height),L=w.map((function(e){return k(e,r.Position,A,P)})),B=w.map((function(e){return k(e,r.Username,A,P)})),N=w.map((function(e){return k(e,r.Time,A,P)})),l("Starting text recognition"),e.next=75,Promise.all([].concat(Object(u.a)(L),Object(u.a)(B),Object(u.a)(N)));case 75:return M=e.sent,R=M.map((function(e){return e.data.text.replace(/\n/g,"").replace(/ /g,"")})),G=R.slice(0,8),console.log("resultsPositions",G),U=R.slice(8,16),console.log("resultsNames",U),D=R.slice(16),console.log("resultsTimes",D),F=[],w.forEach((function(e){var t=U[e],n={username:t,position:G[e],playerFix:x(t,I),time:D[e]};F.push(n)})),J(F),l("Recognition is done and successful"),E(!1),e.next=90,t.terminate();case 90:return e.next=92,n.terminate();case 92:return e.next=94,a.terminate();case 94:e.next=100;break;case 96:e.prev=96,e.t0=e.catch(58),l("Unable to open image ".concat(e.t0.toString(),". Please restart.")),E(!1);case 100:case"end":return e.stop()}}),e,null,[[58,96]])})));return function(){return e.apply(this,arguments)}}(),i=a.useState("Pick an image"),o=Object(s.a)(i,2),c=o[0],l=o[1],f=a.useState(!0),b=Object(s.a)(f,2),w=b[0],E=b[1],k=a.useState(!1),O=Object(s.a)(k,2),_=O[0],P=O[1],S=a.useState(1),C=Object(s.a)(S,2),T=C[0],z=C[1],A=a.useState(void 0),L=Object(s.a)(A,2),B=L[0],J=L[1];a.useEffect((function(){n()}),[T]),a.useEffect((function(){t()}),[]);var M="https://raw.githubusercontent.com/sebranly/ctr-ocr/main/src/img/input/IMG".concat(T,".JPG"),R=[].concat(Object(u.a)(j(1,5)),Object(u.a)(j(11,20)));return a.createElement(d.b,null,a.createElement(d.a,null,a.createElement("title",null,"CTR OCR"),a.createElement("link",{rel:"canonical",href:"https://sebranly.github.io/ctr-ocr"})),a.createElement("div",{className:"main"},a.createElement("h1",{className:"white"},"CTR OCR"),a.createElement("div",null,c),a.createElement("select",{disabled:w,onChange:function(e){z(Number(e.target.value))}},R.map((function(e){var t="Image ".concat(e);return a.createElement("option",{key:e,label:t,value:e},t)}))),a.createElement("img",{alt:"Example ".concat(T),src:M}),B?a.createElement("table",null,a.createElement("thead",null,a.createElement("tr",null,a.createElement("th",null,"Position"),a.createElement("th",null,"Name"),a.createElement("th",null,"Time"))),e()):null,a.createElement("div",{id:"img-show"})))};Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));c.a.render(i.a.createElement(i.a.StrictMode,null,i.a.createElement(J,null),","),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then((function(e){e.unregister()})).catch((function(e){console.error(e.message)}))}},[[140,1,2]]]);
//# sourceMappingURL=main.c83d9498.chunk.js.map